<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui"
	
	
	
	>

<h:head>
<meta Http-Equiv="Cache-Control" Content="no-cache"/>  

<meta Http-Equiv="Pragma" Content="no-cache" />  
<meta Http-Equiv="Expires" Content="0" />
	<!-- BPM -->

	<!-- required modeler styles -->
	<link rel="stylesheet"
		href="https://unpkg.com/bpmn-js@2.5.2/dist/assets/diagram-js.css" />
	<link rel="stylesheet"
		href="https://unpkg.com/bpmn-js@2.5.2/dist/assets/bpmn-font/css/bpmn.css" />

	<!-- modeler distro -->
	<script
		src="https://unpkg.com/bpmn-js@2.5.2/dist/bpmn-modeler.development.js"></script>

	<!-- needed for this example only -->
	<script src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>

	<!-- example styles -->
	<style>
html, body, #canvas {
	height: 100%;
	padding: 0;
	margin: 0;
}

.diagram-note {
	background-color: rgba(66, 180, 21, 0.7);
	color: White;
	border-radius: 5px;
	font-family: Arial;
	font-size: 12px;
	padding: 5px;
	min-height: 16px;
	width: 50px;
	text-align: center;
}

.needs-discussion:not (.djs-connection ) .djs-visual>:nth-child(1) {
	stroke: rgba(66, 180, 21, 0.7) !important; /* color elements as red */
}

#save-button {
	position: fixed;
	bottom: 20px;
	left: 20px;
}
</style>

</h:head>


<ui:composition template="/index.xhtml">






	<ui:define name="botoes">

	<h:form id="formId">
	
	
					<h:inputHidden id="x" value="#{diagramaBean.diagrama}" />
										<h:inputHidden id="y" value="#{diagramaBean.oi}" />
					
					<p:commandButton value="Salvar" onclick="exportDiagram()"
						action="#{diagramaBean.exibir}" class="btn btn-primary btn-md"/>
				</h:form>


	</ui:define>



	<ui:define name="corpo">
	
	<div id = "corpoGeral">
	
	
		<input type="hidden" id="diagramUrl" value="#{diagramaBean.oi}" /> <input
				type="hidden" id="saveDiagram" value="#{diagramaBean.diagrama}" />


			<DIV style="height: 200px">






			




				<div id="canvas"></div>



				<script>
					//var diagramUrl = 'diagram.bpmn';

					function exportDiagram() {

						bpmnModeler
								.saveXML(
										{
											format : true
										},
										function(err, xml) {

											if (err) {
												return console
														.error(
																'could not save BPMN 2.0 diagram',
																err);
											}
											document.getElementById("formId:x").value = xml;
											document.getElementById("formId:y").value = xml;

											
											

											alert('Diagrama Salvo com Sucesso!');

											console.log('DIAGRAM', xml);
										});
					}

					// modeler instance
					var bpmnModeler = new BpmnJS({
						container : '#canvas',
						keyboard : {
							bindTo : window
						}
					});

					/**
					 * Save diagram contents and print them to the console.
					 */

					/**
					 * Open diagram in our modeler instance.
					 *
					 * @param {String} bpmnXML diagram to display
					 */
					function openDiagram(bpmnXML) {

						// import diagram
						bpmnModeler
								.importXML(
										bpmnXML,
										function(err) {

											if (err) {
												return console
														.error(
																'could not import BPMN 2.0 diagram',
																err);
											}

											// access modeler components
											var canvas = bpmnModeler
													.get('canvas');
											var overlays = bpmnModeler
													.get('overlays');

											// zoom to fit full viewport
											canvas.zoom('fit-viewport');

											// attach an overlay to a node
											overlays
													.add(
															'SCAN_OK',
															'note',
															{
																position : {
																	bottom : 0,
																	right : 0
																},
																html : '<div class="diagram-note">Mixed up the labels?</div>'
															});

											// add marker
											canvas.addMarker('SCAN_OK',
													'needs-discussion');
										});
					}

					// load external diagram file via AJAX and open it
					$.get(diagramUrl.value, openDiagram, 'text');

					// wire save button
					//  $('#save-button').click(exportDiagram);
				</script>
			</DIV>
	
	
	</div>
	
		
	</ui:define>


</ui:composition>

</html>